# üö® –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –ó–ê–©–ò–¢–ê FreePBX - CVE-2024-45602

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å!

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ zero-day —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ FreePBX** –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —É–¥–∞–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

- **CVE:** CVE-2024-45602  
- **–†–∏—Å–∫:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
- **–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø—É—â–µ–Ω–æ

## ‚ö° –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

### 1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É (–°–†–û–ß–ù–û!)

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å FreePBX (–ø–æ—Ä—Ç—ã 8080, 8443) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω **–¢–û–õ–¨–ö–û —Å –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤**.

#### –í–∞—Ä–∏–∞–Ω—Ç A: Hetzner Cloud Firewall (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
# 1. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à –≤–Ω–µ—à–Ω–∏–π IP
curl ifconfig.me

# 2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç
nano hetzner-firewall.sh
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_TRUSTED_IP –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π IP

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞—â–∏—Ç—É
./hetzner-firewall.sh
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: UFW –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@37.27.240.184

# –£–∑–Ω–∞–π—Ç–µ –≤–∞—à IP (—Å –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç–µ—Å—å)
echo $SSH_CLIENT | awk '{print $1}'

# –ó–∞–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –≤–µ–±-–ø–æ—Ä—Ç—ã –¥–ª—è –≤—Å–µ—Ö
ufw delete allow 8080/tcp
ufw delete allow 8443/tcp

# –†–∞–∑—Ä–µ—à–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ IP
ufw allow from –í–ê–®_IP to any port 8080 proto tcp
ufw allow from –í–ê–®_IP to any port 8443 proto tcp

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞
ufw reload
ufw status
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ FreePBX

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
cd /opt/freepbx
docker-compose pull
docker-compose down
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
./logs.sh
```

## üõ°Ô∏è –ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ß—Ç–æ –û–¢–ö–†–´–í–ê–ï–ú –¥–ª—è –≤—Å–µ—Ö:
- **5060/udp, 5060/tcp** - SIP –ø—Ä–æ—Ç–æ–∫–æ–ª (–Ω—É–∂–µ–Ω –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤)
- **5160/udp, 5160/tcp** - PJSIP –ø—Ä–æ—Ç–æ–∫–æ–ª
- **10000-20000/udp** - RTP –º–µ–¥–∏–∞ (–≥–æ–ª–æ—Å/–≤–∏–¥–µ–æ)

### –ß—Ç–æ –û–ì–†–ê–ù–ò–ß–ò–í–ê–ï–ú –ø–æ IP:
- **22/tcp** - SSH (—Ç–æ–ª—å–∫–æ –≤–∞—à IP)
- **8080/tcp** - FreePBX Web (—Ç–æ–ª—å–∫–æ –≤–∞—à IP)
- **8443/tcp** - FreePBX HTTPS (—Ç–æ–ª—å–∫–æ –≤–∞—à IP)

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
```bash
# –° –≤–∞—à–µ–≥–æ IP –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:
curl -I http://37.27.240.184:8080

# –° –¥—Ä—É–≥–æ–≥–æ IP –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SIP —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –¢–µ–ª–µ—Ñ–æ–Ω—ã –¥–æ–ª–∂–Ω—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
- –ó–≤–æ–Ω–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ UFW —Å—Ç–∞—Ç—É—Å
```bash
ufw status numbered
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Hetzner Cloud Firewall

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Hetzner CLI: `hcloud`
2. –¢–æ–∫–µ–Ω API –æ—Ç Hetzner Cloud
3. –ó–Ω–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ IP –∞–¥—Ä–µ—Å–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CLI:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ hcloud CLI (Ubuntu/Debian)
wget https://github.com/hetznercloud/cli/releases/latest/download/hcloud-linux-amd64.tar.gz
tar -xzf hcloud-linux-amd64.tar.gz
sudo mv hcloud /usr/local/bin/

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞
hcloud context create freepbx
# –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à API —Ç–æ–∫–µ–Ω –æ—Ç Hetzner

# –ü—Ä–æ–≤–µ—Ä–∫–∞
hcloud server list
```

## üÜò –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å)

### –ï—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:
```bash
# –ß–µ—Ä–µ–∑ SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ufw allow 8080/tcp
ufw allow 8443/tcp
ufw reload
```

### –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–µ–ª–µ—Ñ–æ–Ω—ã:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SIP –ø–æ—Ä—Ç—ã
ufw allow 5060/udp
ufw allow 5060/tcp
ufw allow 5160/udp
ufw allow 5160/tcp
ufw allow 10000:20000/udp
ufw reload
```

## üìû –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

1. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** http://37.27.240.184:8080 (—Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ IP)
2. **SIP —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** —Ç–µ–ª–µ—Ñ–æ–Ω—ã –¥–æ–ª–∂–Ω—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
3. **–ó–≤–æ–Ω–∫–∏:** –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–≤–æ–Ω–∫–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å
4. **SSH:** –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ IP

## ‚ö†Ô∏è –í–ê–ñ–ù–û!

- **–ù–ï –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ** –ø–æ—Ä—Ç—ã 8080/8443 –¥–ª—è –≤—Å–µ—Ö IP –¥–æ –≤—ã—Ö–æ–¥–∞ –ø–∞—Ç—á–∞
- **–û–±–Ω–æ–≤–∏—Ç–µ** FreePBX –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ** –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø** –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
cd /opt/freepbx
./backup.sh
```